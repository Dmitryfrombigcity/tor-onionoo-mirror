name: Mirror Tor onionoo data

on:
  schedule:
    - cron: '27 */12 * * *'
  workflow_dispatch:

jobs:
  onionoo:
    name: Mirror Tor onionoo data
    runs-on: ubuntu-24.04
    permissions:
        contents: write
    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Update onionoo data
        run: |
          curl -f --max-time 60 --compressed -o "details-running-relays" \
          'https://onionoo.torproject.org/details?type=relay&running=true&recommended_version=true&fields=fingerprint,or_addresses,first_seen,country_name,guard_probability,advertised_bandwidth'

      - name: Commit report
        run: |
          git config --global user.name 'Github Actions'
          git config --global user.email 'none@users.noreply.github.com'
          git add details-running-relays
          git commit -m "Onionoo update"
          git push